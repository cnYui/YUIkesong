# 帖子详情页优化 - 图片展示增强

## 实现内容

### ✅ 1. 图片指示器移到底部

**修改前**：
- 指示器在图片下方
- 黑色小圆点

**修改后**：
- 指示器在图片底部（悬浮在图片上）
- 白色小圆点，带阴影效果
- 当前图片的指示器更长（24px），其他的较短（8px）
- 半透明效果，不遮挡图片主要内容

### ✅ 2. 衣服图片作为大图展示

**实现逻辑**：
1. 发布穿搭时，后端将所有图片（造型图 + 衣服图）保存到 `community_post_images` 表
2. 帖子详情API返回完整图片数组
3. 前端使用 `PageView` 显示所有图片，用户可以左右滑动查看
4. 第一张：造型效果图
5. 后续：衣服单品大图

### 📐 UI设计

```
┌────────────────────────┐
│                        │
│                        │
│    造型效果图          │
│    (第1张)            │
│                        │
│                        │
│  ⚪━━━━ ⚪ ⚪ ⚪     │ ← 底部指示器（悬浮）
└────────────────────────┘
       ↓ 左右滑动
┌────────────────────────┐
│                        │
│                        │
│    衣服单品图          │
│    (第2张)            │
│                        │
│                        │
│  ⚪ ⚪━━━━ ⚪ ⚪     │ ← 底部指示器
└────────────────────────┘
```

### 🎨 指示器样式

```dart
// 选中状态
width: 24px
height: 8px
color: white (100% opacity)
shadow: black 20% opacity, blur 4px

// 未选中状态
width: 8px
height: 8px
color: white (50% opacity)
shadow: black 20% opacity, blur 4px
```

## 代码修改

### 文件：`stitch_flutter/lib/pages/post_detail_page.dart`

#### 修改点1：图片展示区域

```dart
// 使用 Stack 组合图片和指示器
Stack(
  children: [
    // 图片轮播
    PageView.builder(
      controller: _pageController,
      itemCount: widget.images.length,
      onPageChanged: (index) => setState(() => _currentImageIndex = index),
      itemBuilder: (context, index) {
        return Image.network(
          _getImageUrl(widget.images[index]),
          fit: BoxFit.cover,
        );
      },
    ),
    // 底部指示器（悬浮在图片上）
    if (widget.images.length > 1)
      Positioned(
        bottom: 16,
        left: 0,
        right: 0,
        child: Row(
          mainAxisAlignment: MainAxisAlignment.center,
          children: List.generate(widget.images.length, (index) {
            final selected = index == _currentImageIndex;
            return AnimatedContainer(
              duration: const Duration(milliseconds: 200),
              width: selected ? 24 : 8,  // 当前图片的指示器更长
              height: 8,
              decoration: BoxDecoration(
                color: selected 
                    ? Colors.white 
                    : Colors.white.withOpacity(0.5),
                borderRadius: BorderRadius.circular(999),
                boxShadow: [
                  BoxShadow(
                    color: Colors.black.withOpacity(0.2),
                    blurRadius: 4,
                    offset: const Offset(0, 2),
                  ),
                ],
              ),
            );
          }),
        ),
      ),
  ],
)
```

## 数据流程

### 发布穿搭到社区

1. **前端**：用户在"我保存的穿搭"页面选择穿搭，点击"发布到社区"
2. **后端** (`saved-looks.js`):
   ```javascript
   // 创建帖子图片记录
   const postImages = [
     {
       id: uuidv4(),
       post_id: postId,
       image_url: savedLook.cover_image_url,  // 第一张：造型图
       sort_order: 0
     }
   ];
   
   // 添加衣服图片
   if (wardrobeImages.length > 0) {
     wardrobeImages.forEach((imageUrl, index) => {
       postImages.push({
         id: uuidv4(),
         post_id: postId,
         image_url: imageUrl,              // 后续：衣服单品图
         sort_order: index + 1
       });
     });
   }
   ```

### 查看帖子详情

1. **前端**：用户点击帖子进入详情页
2. **后端** (`community.js`):
   ```javascript
   // 获取帖子图片（按sort_order排序）
   const { data: images } = await supabase
     .from('community_post_images')
     .select('image_url, sort_order')
     .eq('post_id', id)
     .order('sort_order', { ascending: true });
   
   res.json({
     id: post.id,
     images: (images || []).map(img => img.image_url),  // 返回所有图片
     // ...
   });
   ```
3. **前端**：接收图片数组，使用 `PageView` 展示

## 用户体验

### 查看帖子

1. 打开帖子详情页
2. 第一张图片是完整的造型效果图
3. 向左滑动查看衣服单品详情
4. 底部白色指示器显示当前位置
5. 可以快速浏览所有相关图片

### 发布穿搭

1. 在"我保存的穿搭"中选择喜欢的造型
2. 点击"发布到社区"
3. 造型图和使用的衣服图片会一起发布
4. 其他用户可以看到完整的穿搭方案

## 技术细节

### 图片比例
- 使用 `AspectRatio: 3/4` 保持一致的显示效果
- 适合展示人物全身照和衣服单品

### 性能优化
- 使用 `PageView.builder` 懒加载图片
- 只在有多张图片时显示指示器
- `AnimatedContainer` 平滑过渡动画

### 错误处理
- 图片加载失败显示占位符
- 灰色背景 + 破损图标提示

## 后续可能的优化

1. **图片预览**：点击图片进入全屏预览模式
2. **双击点赞**：双击图片快速点赞
3. **长按保存**：长按图片保存到相册
4. **缩放功能**：支持图片放大查看细节
5. **图片说明**：每张图片可以添加独立的说明文字

